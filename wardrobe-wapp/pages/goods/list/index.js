"use strict";var app=getApp();Page({data:{indicatorDots:!0,autoplay:!0,interval:3e3,duration:1e3,loadingHidden:!1,userInfo:{},selectCurrent:0,goods:[],scrollTop:"0",loadingMoreHidden:!0,lastPage:0,currentPage:1,styleValue:"",styleIndex:0,styleList:[],categoryValue:"",categoryIndex:0,categoryList:[],materialValue:"",materialIndex:0,materialList:[],isShowFilter:!1},onShareAppMessage:function(){return app.onShareAppMessage({path:"/pages/index/index",title:app.getCookie("syc_appName")||"衣否",imgUrl:"/images/logo.jpg"})},getStyleList:function(){var t=this;app.wxRequest("/dict/getDicts",{dictName:"COMM_STYLE"},function(e){1==e.code?t.setData({styleList:e.data.dicts}):app.showToast(e.message||"获取字典失败")})},bindStyleTap:function(t){var e=t.currentTarget.dataset,a=this.data.styleList[e.index];a.selected=!a.selected,this.setData({styleIndex:e.index,styleValue:e.id,styleList:this.data.styleList})},getCategoryList:function(){var t=this;app.wxRequest("/dict/getDicts",{dictName:"COMM_CATEGORY"},function(e){1==e.code?t.setData({categoryList:e.data.dicts}):app.showToast(e.message||"获取字典失败")})},bindCategoryTap:function(t){var e=t.currentTarget.dataset,a=this.data.categoryList[e.index];a.selected=!a.selected,this.setData({categoryIndex:e.index,categoryValue:e.id,categoryList:this.data.categoryList})},getMaterialList:function(){var t=this;app.wxRequest("/dict/getDicts",{dictName:"COMM_MATERIAL"},function(e){1==e.code?t.setData({materialList:e.data.dicts}):app.showToast(e.message||"获取字典失败")})},bindMaterialTap:function(t){var e=t.currentTarget.dataset,a=this.data.materialList[e.index];a.selected=!a.selected,this.setData({materialIndex:e.index,materialValue:e.id,materialList:this.data.materialList})},getSelectedItems:function(){for(var t=[],e=0;e<this.data.styleList.length;e++)this.data.styleList[e].selected&&t.push(this.data.styleList[e].dictId);for(var a=[],s=0;s<this.data.categoryList.length;s++)this.data.categoryList[s].selected&&a.push(this.data.categoryList[s].dictId);for(var i=[],o=0;o<this.data.materialList.length;o++)this.data.materialList[o].selected&&i.push(this.data.materialList[o].dictId);return{category:a.length>0?","+a.join(",|,")+",":"",style:t.length>0?","+t.join(",|,")+",":"",material:i.length>0?","+i.join(",|,")+",":""}},clearSelectedItems:function(){for(var t=0;t<this.data.styleList.length;t++)this.data.styleList[t].selected=!1;for(var e=0;e<this.data.categoryList.length;e++)this.data.categoryList[e].selected=!1;for(var a=0;a<this.data.materialList.length;a++)this.data.materialList[a].selected=!1;this.setData({styleList:this.data.styleList,categoryList:this.data.categoryList,materialList:this.data.materialList})},bindConfirmTap:function(){this.getGoodsList(1),this.setData({isShowFilter:!1})},bindResetTap:function(){this.clearSelectedItems(),this.getGoodsList(1),this.setData({isShowFilter:!1})},bindFilterTap:function(){this.setData({isShowFilter:!0})},toDetailsTap:function(t){app.redirect("/pages/goods/details/index?id="+t.currentTarget.dataset.id,"navigateTo")},onReachBottom:function(){if(this.data.currentPage>=this.data.lastPage)return app.showToast("已经最后一页","none");this.getGoodsList(++this.data.currentPage)},onLoad:function(){this.getCategoryList(),this.getStyleList(),this.getMaterialList(),this.getGoodsList(1)},addShopFavorite:function(t){var e=this,a=t.currentTarget.dataset.id;app.wxRequest("/user/saveCollection",{cid:a},function(t){1==t.code?(e.data.goods.forEach(function(t){t.cid==a&&(t.collection=1)}),e.setData({goods:e.data.goods})):app.showToast(t.message||"添加收藏失败")})},removeShopFavorite:function(t){var e=this,a=t.currentTarget.dataset.id;app.wxRequest("/user/cancelCollection",{cid:a},function(t){1==t.code?(e.data.goods.forEach(function(t){t.cid==a&&(t.collection=2)}),e.setData({goods:e.data.goods})):app.showToast(t.message||"移除收藏失败")})},getGoodsList:function(t){var e=this,a=e.getSelectedItems();a.page=t||1,app.wxRequest("/commodity/index",a,function(t){var s=t.data;1==t.code?1==a.page?e.setData({goods:s.list,lastPage:s.lastPage,currentPage:s.currentPage}):e.setData({goods:e.data.goods.concat(s.list),lastPage:s.lastPage,currentPage:s.currentPage}):(e.setData({goods:[],lastPage:0,currentPage:1}),app.showToast(t.message||"获取商品列表失败"))})}});