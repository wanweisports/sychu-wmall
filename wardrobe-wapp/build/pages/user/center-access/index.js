"use strict";var app=getApp();Page({data:{wardrobeInfo:{},locksList:[]},getWardrobeList:function(){var e=this;app.wxRequest("/device/devices",{},function(t){var a=new Date;a.getTime();if(1==t.code){var o=t.data.list[0];e.setData({wardrobeInfo:o}),e.getWardrobeOrderLocks()}})},getWardrobeOrderLocks:function(){var e=this;app.wxRequest("/order/nowCanOpenLock",{did:e.data.wardrobeInfo.did},function(t){if(1==t.code){var a=t.data.locks;a.length>0?e.setData({locksList:a}):e.setData({locksList:null})}})},getWardrobeOrder:function(){app.wxRequest("/order/reserveOrderInfo",{},function(e){if(1==e.code){e.data.list.length>0&&app.redirect("/pages/user/reserve/index","redirectTo")}})},openLock:function(e){app.wxRequest("/relay/openLock",{lockId:e.currentTarget.dataset.id},function(e){1==e.code&&app.showToast("开柜成功","success")})},onShow:function(){this.getWardrobeOrder(),this.getWardrobeList(),app.setCookie("syc_leave","/pages/user/center-access/index"),this.yesUserStatus()},toCartOrder:function(){app.redirect("/pages/goods/reserve-settle/index?did="+this.data.wardrobeInfo.did,"navigateTo")},readCartSettle:function(e){app.wxRequest("/rfid/readRfid",{did:this.data.wardrobeInfo.did},function(t){if(1==t.code){var a=t.data.data.commoditys;if(!a||a.length<=0)return e(!0)}e(!1)},function(){e(!1)})},leave:function(){var e=this;wx.showModal({title:"提 示",content:"开门前请将未结算的衣服放回衣柜，确认离开吗？",success:function(t){t.confirm&&e.readCartSettle(function(t){if(!t)return app.showToast("请将未结算的衣服放回衣柜中！");app.wxRequest("/relay/closeDoor",{did:6},function(t){1==t.code&&(app.showToast("开门成功","success"),e.noUserStatus(),app.redirect("/pages/index/index","switchTab"))})})}})},onHide:function(){app.clearCookie("syc_leave")},onUnload:function(){app.clearCookie("syc_leave")},yesUserStatus:function(){app.updateUserStatus(1,function(e){e&&app.getCookie("syc_fitting","yes")})},noUserStatus:function(){app.updateUserStatus(2,function(e){e&&app.getCookie("syc_fitting","no")})}});